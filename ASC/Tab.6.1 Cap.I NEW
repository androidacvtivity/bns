--INSERT INTO  TABLE_OUT
--    (
--      PERIOADA,
--      FORM,
--      FORM_VERS,
--      ID_MDTABLE,
--      COD_CUATM,
--      NR_SECTIE,
--      NUME_SECTIE,
--      NR_SECTIE1,
--      NUME_SECTIE1,
--      NR_SECTIE2,
--      NUME_SECTIE2,
--      NR_ROW,
--      ORDINE,
--      DECIMAL_POS,
--      NUME_ROW,
--      COL1,
--      COL2,
--      COL3,
--      COL4
--     
--    )

SELECT
  :PPERIOADA AS PERIOADA,
  :PFORM AS FORM,
  :PFORM_VERS AS FORM_VERS,
  :PID_MDTABLE AS ID_MDTABLE,
  :PCOD_CUATM AS COD_CUATM,
   R.CUIIO AS NR_SECTIE,
   R.CUIIO ||'-'||TT.DENUMIRE AS NUME_SECTIE,
  '0' AS NR_SECTIE1,
  '0' AS NUME_SECTIE1,
  '0' AS NR_SECTIE2,
  '0' AS NUME_SECTIE2,
   RD.RIND AS NR_ROW,
   RD.ORDINE AS ORDINE,
   '00000000' AS DECIMAL_POS,
   RD.DENUMIRE  AS NUME_ROW, 
   CIS2.NVAL(SUM(CASE WHEN D.CAPITOL IN (1010) AND (D.PERIOADA=:PPERIOADA)       THEN D.COL1 ELSE NULL END)) AS COL1,
   NULL COL2,
   NULL COL3,
   NULL COL4


   
   
   FROM
  CIS2.VW_DATA_ALL D
  INNER JOIN CIS2.RENIM R ON R.CUIIO=D.CUIIO AND R.CUIIO_VERS=D.CUIIO_VERS
  INNER JOIN CIS2.MD_RIND RD ON (RD.CAPITOL=D.CAPITOL AND RD.CAPITOL_VERS=D.CAPITOL_VERS AND RD.RIND=D.RIND)
  
LEFT JOIN
  
(
SELECT R.CUIIO, R.DENUMIRE FROM CIS2.RENIM R
INNER JOIN 
  (
  SELECT DISTINCT CUIIO, MAX(CUIIO_VERS) AS CUIIO_VERS FROM CIS2.RENIM   
   GROUP BY CUIIO
  
   ) RR ON R.CUIIO=RR.CUIIO AND R.CUIIO_VERS=RR.CUIIO_VERS  
   ) TT
  
  ON TT.CUIIO=D.CUIIO 
  
WHERE
  D.FORM IN (20)           AND 
  D.FORM_VERS = :PFORM_VERS   AND
 (D.PERIOADA IN(:pPERIOADA,:pPERIOADA-1,:pPERIOADA-4 ))   AND     
 (D.CAPITOL IN (1010)  AND D.RIND NOT IN ('-')) AND 
  
  D.CUATM_FULL LIKE '%'||:PCOD_CUATM||';%' 
 -- AND D.CUIIO IN (40495636)
  AND D.RIND NOT IN ('1','2','3','4','5','6','00') 
GROUP BY
 RD.RIND,
 RD.DENUMIRE,
 RD.ORDINE,
 R.CUIIO,
 TT.DENUMIRE
 
    ORDER BY 
    R.CUIIO   
    