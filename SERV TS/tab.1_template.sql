--INSERT INTO TABLE_OUT 
--(
--  PERIOADA,
--  FORM,
--  FORM_VERS,
--  ID_MDTABLE,
--  COD_CUATM,
--  NR_SECTIE,
--  NUME_SECTIE,
--  NR_SECTIE1,
--  NUME_SECTIE1,
--  NR_SECTIE2,
--  NUME_SECTIE2,
--  NR_ROW,
--  ORDINE,
--  DECIMAL_POS,
--  NUME_ROW,
--  
--  COL1, COL2, COL3, COL4
--)
--SELECT                                                                    
--  :pPERIOADA AS PERIOADA,                                                    
--  :pFORM AS FORM,                                                            
--  :pFORM_VERS AS FORM_VERS,                                                  
--  :pID_MDTABLE AS ID_MDTABLE,                                                
--  :pCOD_CUATM AS COD_CUATM,                                                  
--  '0' AS NR_SECTIE,                                                         
--  '0' AS NUME_SECTIE,                                                        
--  '0' AS NR_SECTIE1,
--  '0' AS NUME_SECTIE1,
--  '0' AS NR_SECTIE2,
--  '0' AS NUME_SECTIE2,
--   RIND AS NR_ROW,  
--   ORDINE,
--  '0000' AS DECIMAL_POS,
--   NUME_ROW AS NUME_ROW,
--   
--   COL1,
--   COL2,
--   COL3,
--   COL4
--   
--FROM (



SELECT
  B.RIND,  
  B.ORDINE,
  B.NUME_ROW,
  ROUND(SUM(CASE WHEN B.NR_ROW LIKE '%'||SUBSTR(C.CODUL,2,5)||'%' AND D.PERIOADA BETWEEN FLOOR(:pPERIOADA/12)*12 AND :pPERIOADA THEN COL1 END),1) AS COL1,
   
  ROUND(SUM(CASE WHEN D.CAPITOL = 4 AND D.RIND IN '10' AND B.NR_ROW LIKE '%'|| SUBSTR(C.CODUL,2,5) ||'%' AND D.PERIOADA BETWEEN FLOOR((:pPERIOADA-12)/12)*12 AND :pPERIOADA-12 THEN COL1 END),1) AS COL2,
  
  ROUND(SUM(CASE WHEN B.NR_ROW LIKE '%'|| SUBSTR(C.CODUL,2,5) ||'%' AND D.PERIOADA IN :pPERIOADA THEN COL1 END),1) AS COL3,
  
  ROUND(SUM(CASE WHEN D.CAPITOL = 4 AND D.RIND IN '10' AND B.NR_ROW LIKE '%'|| SUBSTR(C.CODUL,2,5) ||'%' AND D.PERIOADA IN :pPERIOADA-1 THEN COL1 END),1) AS COL4

FROM 
  CIS.VW_DATA_ALL_COEF D
  INNER JOIN CIS.VW_CL_CAEM2 C ON C.CODUL = D.CAEM2
  CROSS JOIN
    ( SELECT '5500-5510-5520-5530-5590-5600-5610-5620-5621-5629-5630-7420-7500-7720-7721-7722-7729-7900-7910-7911-7912-7990+8500+8510+8520+8530+8531+8532+8540+8541+8542+8550+8551+8552+8553+8559+8560+8600+8610+8620+8621+8622+8623+8690+8700+8710+8720+8730+8790+8800+8810+8890+8891+8899+5900+5910+5911+5912+5913+5914+5920+6000+6010+6020+9000+9001+9002+9003+9004+9100+9101+9102+9103+9104+9200+9300+9310+9311+9312+9313+9319+9320+9321+9329+9500+9510+9511+9512+9520+9521+9522+9523+9524+9525+9529+9601+9602+9603+9604+0160+0161+0162+0163+0164+7430+9609' AS NR_ROW,0 AS ORDINE, '01' AS RIND, 'Cifra de afeceri (venitul din vinzari) - total:' AS NUME_ROW FROM DUAL UNION
      SELECT '5500+5510+5520+5530+5590+5600+5610+5620+5621+5629+5630' AS NR_ROW,1 AS ORDINE, '02' AS RIND, 'HOTELURI SI RESTAURANTE(55,56)' AS NUME_ROW FROM DUAL UNION
      SELECT '7420' AS NR_ROW, 2 AS ORDINE, '03' AS RIND, 'Activitati fotografice(74.2)' AS NUME_ROW FROM DUAL UNION
      SELECT '7500' AS NR_ROW, 3 AS ORDINE, '04' AS RIND, 'Activitati veterinare(75)' AS NUME_ROW FROM DUAL UNION
      SELECT '7720+7721+7722+7729' AS NR_ROW, 4 AS ORDINE, '05' AS RIND, 'Activitati de inchiriere si leasing de bunuri personale si gospodaresti(77.2)' AS NUME_ROW FROM DUAL UNION
      SELECT '7900+7910+7911+7912+7990' AS NR_ROW, 5 AS ORDINE, '06' AS RIND, 'Activitati ale agentilor turistice si ale tur-operatorilor; alte servicii de rezervare si asistenta turistica(79)' AS NUME_ROW FROM DUAL UNION
      SELECT '8500+8510+8520+8530+8531+8532+8540+8541+8542+8550+8551+8552+8553+8559+8560' AS NR_ROW, 6 AS ORDINE, '07' AS RIND, 'INVATAMINT(85)' AS NUME_ROW FROM DUAL UNION
      SELECT '8600+8610+8620+8621+8622+8623+8690+8700+8710+8720+8730+8790+8800+8810+8890+8891+8899' AS NR_ROW, 7 AS ORDINE, '08' AS RIND, 'SANATATE SI ASISTENTA SOCIALA(86,87,88)' AS NUME_ROW FROM DUAL UNION
      SELECT '5900+5910+5911+5912+5913+5914+5920+6000+6010+6020+9000+9001+9002+9003+9004+9100+9101+9102+9103+9104+9200+9300+9310+9311+9312+9313+9319+9320+9321+9329' AS NR_ROW, 8 AS ORDINE, '09' AS RIND, 'ACTIVITATI RECREATIVE, CULTURALE SI SPORTIVE(59,60,90,91,92,93)' AS NUME_ROW FROM DUAL UNION
      SELECT '9500+9510+9511+9512+9520+9521+9522+9523+9524+9525+9529' AS NR_ROW, 9 AS ORDINE, '10' AS RIND, 'Reparatii de calculatoare, de articole personale si de uz gospodaresc(95)' AS NUME_ROW FROM DUAL UNION
      SELECT '9601' AS NR_ROW, 10  AS ORDINE,'12' AS RIND, 'Spalarea si curatarea (uscata) articolelor textile si a produselor din blana(96.01)' AS NUME_ROW FROM DUAL UNION
      SELECT '9602' AS NR_ROW, 11  AS ORDINE,'13' AS RIND, 'Coafura si alte activitati de infrumusetare(96.02)' AS NUME_ROW FROM DUAL UNION
      SELECT '9603' AS NR_ROW, 12  AS ORDINE,'14' AS RIND, 'Activitati de pompe funebre si similare(96.03)' AS NUME_ROW FROM DUAL UNION
      SELECT '9604' AS NR_ROW, 13  AS ORDINE,'15' AS RIND, 'Activitati de intretinere corporala(96.04)' AS NUME_ROW FROM DUAL UNION 
      SELECT '9609' AS NR_ROW, 14  AS ORDINE,'16' AS RIND, 'Alte activitati de servicii individuale(96.09)' AS NUME_ROW FROM DUAL

    ) B
    
WHERE
 (D.FORM=:pFORM) AND
 (D.FORM_VERS=:pFORM_VERS) AND
 (:pID_MDTABLE=:pID_MDTABLE) AND
 (D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%') AND   
  (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-12)/12)*12 AND :pPERIOADA-12 OR 
     D.PERIOADA BETWEEN FLOOR(:pPERIOADA/12)*12 AND :pPERIOADA OR
     D.PERIOADA IN :pPERIOADA OR
     D.PERIOADA IN :pPERIOADA-1 ) AND
  D.FORM IN (4) AND 
  D.CAPITOL IN (4) AND
  D.RIND IN '10'
  
GROUP BY
  B.NUME_ROW,
  B.RIND,
  B.ORDINE
UNION

SELECT 
  '11' AS RIND,
   9.1 AS ORDINE, 
  'Alte activitati de servicii personale (9600)' AS NUME_ROW,
   
  
  ROUND(SUM(CASE WHEN D.PERIOADA BETWEEN FLOOR(:pPERIOADA/12)*12 AND :pPERIOADA THEN COL1 END),1) AS COL1,
   
  ROUND(SUM(CASE WHEN D.CAPITOL = 4 AND D.RIND IN '10' AND D.PERIOADA BETWEEN FLOOR((:pPERIOADA-12)/12)*12 AND :pPERIOADA-12 THEN COL1 END),1) AS COL2,
  
  ROUND(SUM(CASE WHEN D.PERIOADA IN :pPERIOADA THEN COL1 END),1) AS COL3,
  
  ROUND(SUM(CASE WHEN D.CAPITOL = 4 AND D.RIND IN '10' AND D.PERIOADA IN :pPERIOADA-1 THEN COL1 END),1) AS COL4

FROM
  CIS.VW_DATA_ALL_COEF D
  
WHERE
 (D.FORM=:pFORM) AND
 (D.FORM_VERS=:pFORM_VERS) AND
 (:pID_MDTABLE=:pID_MDTABLE) AND
 (D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%') AND   
  (D.PERIOADA BETWEEN FLOOR((:pPERIOADA-12)/12)*12 AND :pPERIOADA-12 OR 
     D.PERIOADA BETWEEN FLOOR(:pPERIOADA/12)*12 AND :pPERIOADA OR
     D.PERIOADA IN :pPERIOADA OR
     D.PERIOADA IN :pPERIOADA-1 ) AND
  D.FORM IN (4) AND 
  D.CAPITOL IN (4) AND
  D.RIND IN '10' AND
  D.CAEM2 LIKE 'S96%'
  
--)