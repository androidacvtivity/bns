--
--
--CREATE OR REPLACE FORCE VIEW USER_BANCU.VW_CSPM2 
--(
--   CLASS_CODE,
--  ITEM_CODE_VERS,
--  ITEM_CODE,
--  ITEM_PARENT,
--  NAME,
--  SHOW_ORDER,
--  SYS_DATE,
--  SYS_USER,
--  A01,
--  A02,
--  A03,
--  A04,
--  A05,
--  A06,
--  A07,
--  A08,
--  A09,
--  A10,
--  A11,
--  A12,
--  A13,
--  A14,
--  A15,
--  STATUS
--)
--AS

SELECT 
  L.CLASS_CODE,
  L.ITEM_CODE_VERS,
  L.ITEM_CODE,
  L.ITEM_PARENT,
  L.NAME,
  L.SHOW_ORDER,
  L.SYS_DATE,
  L.SYS_USER,
  R.CODUL_OLD A01,
  REPLACE (S.DENUMIRE,'Servicii','S') A02,
  SUBSTR (S.DENUMIRE,1,100) MODIF_A02_,
  LENGTH(SUBSTR (S.DENUMIRE,1,100))  AS LENGTH_,
  L.A03,
  L.A04,
  L.A05,
  L.A06,
  L.A07,
  L.A08,
  L.A09,
  L.A10,
  L.A11,
  L.A12,
  L.A13,
  L.A14,
  L.A15,
  L.STATUS
FROM 

(
SELECT 
  L.CLASS_CODE,
  L.ITEM_CODE_VERS,
  L.ITEM_CODE,
  L.ITEM_PARENT,
  L.NAME,
  L.SHOW_ORDER,
  L.SYS_DATE,
  L.SYS_USER,
  L.A01,
  L.A02,
  L.A03,
  L.A04,
  L.A05,
  L.A06,
  L.A07,
  L.A08,
  L.A09,
  L.A10,
  L.A11,
  L.A12,
  L.A13,
  L.A14,
  L.A15,
  L.STATUS
    
    FROM USER_BANCU.CLS_CLASS_ITEM_USER_BANCU L
     WHERE
                  L.CLASS_CODE IN ('CSPM2') 
    AND L.ITEM_PARENT NOT IN  ('00.00.00')
    ) L  LEFT JOIN (
    
    SELECT
CODUL_NEW ITEM_CODE,
COUNT (CODUL_NEW) CNT, 
CODUL_OLD 
FROM USER_BANCU.CL_SERVICII_NEW


GROUP BY
CODUL_NEW ,
CODUL_OLD
HAVING 
 
COUNT ( CODUL_NEW)  =   1
ORDER BY 
CODUL_NEW

    
    ) R  ON  TRIM(L.ITEM_CODE) = TRIM(R.ITEM_CODE)
    
    LEFT JOIN CIS2.CL_SERVICII S ON S.CODUL = R.CODUL_OLD
        
    
    WHERE 
    1=1


ORDER BY 
LENGTH(REPLACE (S.DENUMIRE,'Servicii','S')) DESC