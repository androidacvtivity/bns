
SELECT 
CUIIO,
DENUMIRE,
CUATM,
CFP,
CAEM2,
RIND_2018_EI7,
RIND_2018_EI8,
RIND_2019_EI7,
RIND_2019_EI8,
RIND_2019_EI7_TRIM1,
RIND_2019_EI8_TRIM1,
RIND_2019_EI7_TRIM2,
RIND_2019_EI8_TRIM2,
RIND_2019_EI7_TRIM3,
RIND_2019_EI8_TRIM3


FROM 

(

SELECT 
D.CUIIO,
R.DENUMIRE,
R.CUATM,
R.CFP,
R.CAEM2,
MAX(CASE WHEN D.PERIOADA = 2007 AND D.FORM IN (46) AND  D.CAPITOL IN (1)   AND D.RIND IN ('02','03','05') THEN  D.RIND ELSE NULL END ) AS RIND_2018_EI7, 
MAX(CASE WHEN D.PERIOADA = 2007 AND D.FORM IN (46) AND  D.CAPITOL IN (404)   AND D.RIND IN ('02','03','05') THEN  D.RIND ELSE NULL END ) AS RIND_2018_EI8,
MAX(CASE WHEN D.PERIOADA = 2008 AND D.FORM IN (46) AND  D.CAPITOL IN (1)   AND D.RIND IN ('02','03','05') THEN  D.RIND ELSE NULL END ) AS RIND_2019_EI7, 
MAX(CASE WHEN D.PERIOADA = 2008 AND D.FORM IN (46) AND  D.CAPITOL IN (404)   AND D.RIND IN ('02','03','05') THEN  D.RIND ELSE NULL END ) AS RIND_2019_EI8,

MAX(CASE WHEN D.PERIOADA = 1044 AND D.FORM IN (44) AND  D.CAPITOL IN (1)   AND D.RIND IN ('02','03','05') THEN  D.RIND ELSE NULL END ) AS RIND_2019_EI7_TRIM1, 
MAX(CASE WHEN D.PERIOADA = 1044 AND D.FORM IN (44) AND  D.CAPITOL IN (14)   AND D.RIND IN ('02','03','05') THEN  D.RIND ELSE NULL END ) AS RIND_2019_EI8_TRIM1,


MAX(CASE WHEN D.PERIOADA = 1045 AND D.FORM IN (44) AND  D.CAPITOL IN (1)   AND D.RIND IN ('02','03','05') THEN  D.RIND ELSE NULL END ) AS RIND_2019_EI7_TRIM2, 
MAX(CASE WHEN D.PERIOADA = 1045 AND D.FORM IN (44) AND  D.CAPITOL IN (14)   AND D.RIND IN ('02','03','05') THEN  D.RIND ELSE NULL END ) AS RIND_2019_EI8_TRIM2,


MAX(CASE WHEN D.PERIOADA = 1046 AND D.FORM IN (44) AND  D.CAPITOL IN (1)   AND D.RIND IN ('02','03','05') THEN  D.RIND ELSE NULL END ) AS RIND_2019_EI7_TRIM3, 
MAX(CASE WHEN D.PERIOADA = 1046 AND D.FORM IN (44) AND  D.CAPITOL IN (14)   AND D.RIND IN ('02','03','05') THEN  D.RIND ELSE NULL END ) AS RIND_2019_EI8_TRIM3
 
 FROM
    
     CIS2.VW_DATA_ALL D 
        INNER JOIN CIS2.RENIM R ON R.CUIIO = D.CUIIO  AND R.CUIIO_VERS = D.CUIIO_VERS
     

      

WHERE 
  (D.PERIOADA IN (2007,2008,2009,1044,1045,1046)) AND 
  
 
  
  (D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%') AND
   
   (
   
   D.FORM IN (46) AND D.CAPITOL IN (1,404) 
   AND D.RIND IN ('02','03','05') 

   ) 
  
OR 

 (
   
   D.FORM IN (44) AND D.CAPITOL IN (1,14) 
   AND D.RIND IN ('02','03','05') 

   ) 

GROUP BY 
D.CUIIO,
R.DENUMIRE,
R.CUATM,
R.CFP,
R.CAEM2

)