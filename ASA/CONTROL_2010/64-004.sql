SELECT 
'CFOJ '||CFOJN|| ' nu corespunde cu CFP '||CFPN AS REZULTAT

FROM(
SELECT
 CASE WHEN CFOJ_NEW IS NOT NULL THEN CFOJ_NEW ELSE CFOJ END AS CFOJN,
 CASE WHEN CFP_NEW IS NOT NULL THEN CFP_NEW ELSE CFP END AS CFPN  
  
FROM
(
SELECT
  D.CUIIO,
  D.CFP,
  MAX(CASE WHEN CAPITOL IN (1129) AND D.RIND IN ('5') AND D.COL31 IS NOT NULL THEN D.COL31 ELSE NULL END) AS CFP_NEW,
  D.CFOJ,
  MAX(CASE WHEN CAPITOL IN (1129) AND D.RIND IN ('1') AND D.COL31 IS NOT NULL THEN D.COL31 ELSE NULL END) AS CFOJ_NEW
FROM
  CIS2.VW_DATA_ALL D
WHERE
  (D.PERIOADA=:PERIOADA         OR :PERIOADA = -1) AND
  (D.CUIIO=:CUIIO               OR :CUIIO = -1) AND
  (D.CUIIO_VERS=:CUIIO_VERS     OR :CUIIO_VERS = -1) AND
  (D.FORM = :FORM               OR :FORM = -1) AND
  (D.FORM_VERS=:FORM_VERS       OR :FORM_VERS = -1) AND
  (D.CAPITOL=:CAPITOL           OR :CAPITOL = -1) AND
  (D.CAPITOL_VERS=:CAPITOL_VERS OR :CAPITOL_VERS = -1) AND
  (D.ID_MD=:ID_MD               OR :ID_MD = -1) AND 
  D.CAPITOL IN (1129) --AND
--  D.RIND IN ('5','1')
GROUP BY
  D.CUIIO,
  D.CFP,
  D.CFOJ
)

GROUP BY CFP,CFOJ,CFP_NEW,CFOJ_NEW
)
GROUP BY CFPN, CFOJN

HAVING

((CASE WHEN CFPN =12 THEN CFOJN  ELSE NULL END) NOT IN ('500', '510', '520', '590', '690'))
OR
((CASE WHEN CFPN =13 THEN CFOJN  ELSE NULL END) NOT IN ('500', '510', '520', '590', '690'))
OR
((CASE WHEN CFPN IN(15, 16, 18) THEN CFOJN  ELSE NULL END) NOT IN  ('420', '430', '440', '450', '500', '510', '520', '530', '540', '541', '550', 
     '560', '690', '993'))
OR
((CASE WHEN CFPN =20 THEN CFOJN  ELSE NULL END) NOT IN ('500', '510', '520', '530', '690'))
OR
((CASE WHEN CFPN =28 THEN CFOJN  ELSE NULL END) NOT IN ('430', '440', '500', '510', '520', '530', '540', '550', '560', '690'))
OR
((CASE WHEN CFPN  IN(23, 24, 25, 26) THEN CFOJN  ELSE NULL END) NOT IN ('500', '510', '520', '530', '540', '550', '560', '690','996'))