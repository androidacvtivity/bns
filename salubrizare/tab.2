--INSERT INTO TABLE_OUT 
--(
--  PERIOADA,
--  FORM,
--  FORM_VERS,
--  ID_MDTABLE,
--  COD_CUATM,
--  NR_SECTIE,
--  NUME_SECTIE,
--  NR_SECTIE1,
--  NUME_SECTIE1,
--  NR_SECTIE2,
--  NUME_SECTIE2,
--  NR_ROW,
--  ORDINE,
--  DECIMAL_POS,
--  NUME_ROW,  
-- COL1, COL2, COL3,COL4,COL5,COL6,COL7,COL8
--)



SELECT
--  :pPERIOADA AS PERIOADA,
--  :pFORM AS FORM,
--  :pFORM_VERS AS FORM_VERS,
--  :pID_MDTABLE AS ID_MDTABLE,
--  :pCOD_CUATM AS COD_CUATM,
--  '0' AS NR_SECTIE,
--  '0' AS NUME_SECTIE,
--  '0' AS NR_SECTIE1,
--  '0' AS NUME_SECTIE1,
--  '0' AS NR_SECTIE2,
--  '0' AS NUME_SECTIE2,
   CODUL||'~'||ORDINE AS NR_ROW,
   ROWNUM AS ORDINE,
  '33333300' AS DECIMAL_POS,
   DENUMIRE AS NUME_ROW,
   COL1,
  COL2,
  COL3,
  COL4,
  COL5,
  COL6,
  COL7,
  COL8
FROM
(


SELECT
  DENUMIRE, 
  CODUL,
  FULL_CODE,
  ORDINE,
  PRGS,
  COL1,
  COL2,
  COL3,
  COL4,
  COL5,
  COL6,
  COL7,
  COL8,
  COL9,
  COL10,
  COL11
FROM
(


SELECT
CC.DENUMIRE,
  CC.CODUL, CC.FULL_CODE, 0 AS ORDINE, CC.PRGS,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL1 ELSE 0 END) AS COL1,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL2 ELSE 0 END) AS COL2,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL3 ELSE 0 END) AS COL3,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL4 ELSE 0 END) AS COL4,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL5 ELSE 0 END) AS COL5,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL6 ELSE 0 END) AS COL6,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL7 ELSE 0 END) AS COL7,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL8 ELSE 0 END) AS COL8,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL9 ELSE 0 END) AS COL9,
  SUM(CASE WHEN CAPITOL IN (366) AND D.RIND IN '1' THEN COL1 ELSE 0 END) AS COL10,
  SUM(CASE WHEN CAPITOL IN (366) AND D.RIND IN '2' THEN COL1 ELSE 0 END) AS COL11
  
FROM
  CIS2.VW_DATA_ALL D
  INNER JOIN CIS2.VW_CL_CUATM C ON (D.RIND=C.CODUL)
  INNER JOIN CIS2.VW_CL_CUATM CC ON (C.FULL_CODE LIKE '%'||CC.CODUL||'%')
  
WHERE
  (D.PERIOADA=:pPERIOADA) AND
  (D.FORM=:pFORM) AND
  (D.FORM_VERS=:pFORM_VERS) AND
  (:pID_MDTABLE=:pID_MDTABLE) AND
  (D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%') AND
   D.FORM = 25 AND
   D.CAPITOL IN (365,366) AND 
   D.RIND NOT IN ('0000000')  AND
   CC.PRGS NOT IN (3,4,6,8,9) AND
   CC.CODUL NOT IN ('0101000','9601000')
   
GROUP BY CC.DENUMIRE,
  CC.CODUL, CC.FULL_CODE,CC.PRGS
UNION
SELECT
C.DENUMIRE,
  C.CODUL, C.FULL_CODE, 0 AS ORDINE, C.PRGS,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL1 ELSE 0 END) AS COL1,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL2 ELSE 0 END) AS COL2,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL3 ELSE 0 END) AS COL3,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL4 ELSE 0 END) AS COL4,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL5 ELSE 0 END) AS COL5,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL6 ELSE 0 END) AS COL6,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL7 ELSE 0 END) AS COL7,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL8 ELSE 0 END) AS COL8,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL9 ELSE 0 END) AS COL9,
  SUM(CASE WHEN CAPITOL IN (366) AND D.RIND IN '1' THEN COL1 ELSE 0 END) AS COL10,
  SUM(CASE WHEN CAPITOL IN (366) AND D.RIND IN '2' THEN COL1 ELSE 0 END) AS COL11
  
FROM
  CIS2.VW_DATA_ALL D
  INNER JOIN CIS2.VW_CL_CUATM C ON (D.RIND=C.CODUL)
--  INNER JOIN CIS2.VW_CL_CUATM CC ON (C.FULL_CODE LIKE '%'||CC.CODUL||'%')
  
WHERE
  (D.PERIOADA=:pPERIOADA) AND
  (D.FORM=:pFORM) AND
  (D.FORM_VERS=:pFORM_VERS) AND
  (:pID_MDTABLE=:pID_MDTABLE) AND
  (D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%') AND
   D.FORM = 25 AND
   D.CAPITOL IN (365,366) AND 
   D.RIND NOT IN '0000000' AND
   C.PRGS IN (3,6,8,9)
   
GROUP BY C.DENUMIRE,
  C.CODUL, C.FULL_CODE,C.PRGS
UNION
  SELECT
  CASE WHEN D.RIND  IN('0101000') THEN 'OR.CHISINAU' ELSE 'MUN.COMRAT' END AS DENUMIRE,
  CASE WHEN D.RIND  IN('0101000') THEN '0101000' ELSE '9601000' END AS CODUL, 
  CASE WHEN D.RIND  IN('0101000') THEN '0000000;0100000;0101000;' ELSE '0000000;9600000;9601000;' END AS FULL_CODE, 
  0 AS ORDINE, 
  '5' AS PRGS,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL1 ELSE 0 END) AS COL1,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL2 ELSE 0 END) AS COL2,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL3 ELSE 0 END) AS COL3,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL4 ELSE 0 END) AS COL4,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL5 ELSE 0 END) AS COL5,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL6 ELSE 0 END) AS COL6,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL7 ELSE 0 END) AS COL7,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL8 ELSE 0 END) AS COL8,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL9 ELSE 0 END) AS COL9,
  SUM(CASE WHEN CAPITOL IN (366) AND D.RIND IN '1' THEN COL1 ELSE 0 END) AS COL10,
  SUM(CASE WHEN CAPITOL IN (366) AND D.RIND IN '2' THEN COL1 ELSE 0 END) AS COL11
  
FROM
  CIS2.VW_DATA_ALL D
  INNER JOIN CIS2.VW_CL_CUATM C ON (D.RIND=C.CODUL)
  
WHERE
  (D.PERIOADA=:pPERIOADA) AND
  (D.FORM=:pFORM) AND
  (D.FORM_VERS=:pFORM_VERS) AND
  (:pID_MDTABLE=:pID_MDTABLE) AND
  (D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%') AND
  D.FORM = 25 AND
  D.CAPITOL IN (365,366) AND --C.PRGS IN 5
  D.RIND IN ('0101000','9601000')
GROUP BY
  D.RIND

UNION
SELECT
  DENUMIRE,
  CODUL,
  FULL_CODE,
  ORDINE,
  PRGS,
  COL1,
  COL2,
  COL3,
  COL4,
  COL5,
  COL6,
  COL7,
  COL8,
  COL9,
  COL10,
  COL11
FROM
(
SELECT
'Localitati urbane' AS DENUMIRE,
  CC.CODUL, CC.FULL_CODE, 1 AS ORDINE, CC.PRGS,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL1 ELSE 0 END) AS COL1,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL2 ELSE 0 END) AS COL2,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL3 ELSE 0 END) AS COL3,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL4 ELSE 0 END) AS COL4,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL5 ELSE 0 END) AS COL5,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL6 ELSE 0 END) AS COL6,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL7 ELSE 0 END) AS COL7,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL8 ELSE 0 END) AS COL8,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL9 ELSE 0 END) AS COL9,
  SUM(CASE WHEN CAPITOL IN (366) AND D.RIND IN '1' THEN COL1 ELSE 0 END) AS COL10,
  SUM(CASE WHEN CAPITOL IN (366) AND D.RIND IN '2' THEN COL1 ELSE 0 END) AS COL11
  
FROM
  CIS2.VW_DATA_ALL D
  INNER JOIN CIS2.VW_CL_CUATM C ON (D.RIND=C.CODUL)
  INNER JOIN CIS2.VW_CL_CUATM CC ON (C.FULL_CODE LIKE '%'||CC.CODUL||'%')
  
WHERE
  (D.PERIOADA=:pPERIOADA) AND
  (D.FORM=:pFORM) AND
  (D.FORM_VERS=:pFORM_VERS) AND
  (:pID_MDTABLE=:pID_MDTABLE) AND
  (D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%') AND
   D.FORM = 25 AND
   D.CAPITOL IN (365,366) AND
   C.PRGS IN (2,3,5)
   
GROUP BY CC.DENUMIRE,
  CC.CODUL, CC.FULL_CODE, CC.PRGS
ORDER BY CC.FULL_CODE
)
WHERE
  PRGS IN (2)
UNION
SELECT
  DENUMIRE,
  CODUL,
  FULL_CODE,
  ORDINE,
  PRGS,
  COL1,
  COL2,
  COL3,
  COL4,
  COL5,
  COL6,
  COL7,
  COL8,
  COL9,
  COL10,
  COL11
FROM
(
SELECT
'Localitati rurale' AS DENUMIRE,
  CC.CODUL, CC.FULL_CODE, 2 AS ORDINE, CC.PRGS,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL1 ELSE 0 END) AS COL1,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL2 ELSE 0 END) AS COL2,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL3 ELSE 0 END) AS COL3,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL4 ELSE 0 END) AS COL4,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL5 ELSE 0 END) AS COL5,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL6 ELSE 0 END) AS COL6,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL7 ELSE 0 END) AS COL7,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL8 ELSE 0 END) AS COL8,
  SUM(CASE WHEN CAPITOL IN (365) AND D.RIND NOT IN '0000000' THEN COL9 ELSE 0 END) AS COL9,
  SUM(CASE WHEN CAPITOL IN (366) AND D.RIND IN '1' THEN COL1 ELSE 0 END) AS COL10,
  SUM(CASE WHEN CAPITOL IN (366) AND D.RIND IN '2' THEN COL1 ELSE 0 END) AS COL11
  
FROM
  CIS2.VW_DATA_ALL D
  INNER JOIN CIS2.VW_CL_CUATM C ON (D.RIND=C.CODUL)
  INNER JOIN CIS2.VW_CL_CUATM CC ON (C.FULL_CODE LIKE '%'||CC.CODUL||'%')
  
WHERE
  (D.PERIOADA=:pPERIOADA) AND
  (D.FORM=:pFORM) AND
  (D.FORM_VERS=:pFORM_VERS) AND
  (:pID_MDTABLE=:pID_MDTABLE) AND
  (D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%') AND
   D.FORM = 25 AND
   D.CAPITOL IN (365,366) AND
   C.PRGS IN (6,8,9)
   
GROUP BY CC.DENUMIRE,
  CC.CODUL, CC.FULL_CODE, CC.PRGS
ORDER BY CC.FULL_CODE
)
WHERE
  PRGS IN (2)
)
--WHERE
--  PRGS NOT IN (4)
ORDER BY
  FULL_CODE,
  ORDINE
  
  )