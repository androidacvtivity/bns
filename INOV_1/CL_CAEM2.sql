SELECT

  CC.CODUL,
  CC.DENUMIRE, 
  SUM(D.COL1) AS COL1
  
   
FROM
(

SELECT
  D.CUIIO,
  D.CAEM2,
   CIS2.NVAL(MAX(CASE WHEN D.CAPITOL||'.'||D.RIND IN ('1041.2.1.1','1041.2.1.2', '1042.3.1.1','1042.3.1.2','1042.3.1.3','1046.7.1.1','1046.7.1.2','1046.7.1.3','1047.8.1.1','1047.8.1.2','1047.8.1.3','1047.8.1.4') AND D.COL1=1 
  THEN D.COL1 ELSE NULL END)) AS COL1
  
  FROM 
  CIS2.VW_DATA_ALL D  
  
  
WHERE
  D.PERIOADA IN (:pPERIOADA) AND 
  D.FORM_VERS = :pFORM_VERS     AND   
  D.FORM = :pFORM     AND    
  (:pID_MDTABLE=:pID_MDTABLE) AND
  D.CUATM_FULL LIKE '%'||:pCOD_CUATM||';%'  AND 
  D.FORM IN (48)  

  
GROUP BY  
D.CUIIO,
D.CAEM2
) D 

INNER JOIN CIS2.VW_CL_CAEM2 C ON C.CODUL = D.CAEM2
INNER JOIN CIS2.VW_CL_CAEM2 CC ON C.FULL_CODE LIKE '%'||CC.CODUL||'%'
GROUP BY

 CC.CODUL,
 CC.DENUMIRE,
 CC.FULL_CODE
 
 ORDER BY
 CC.FULL_CODE

